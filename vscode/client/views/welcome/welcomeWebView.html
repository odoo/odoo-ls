<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="module" nonce="<%= nonce %>" src="<%= webviewElementsUri %>"></script>
        <script type="module" nonce="<%= nonce %>" src="<%= mainUri %>"></script>
        <link rel="stylesheet" href="<%= styleUri %>">
        <meta http-equiv="Content-Security-Policy" content="default-src 'none'; style-src <%= cspSource %>; img-src <%= cspSource %> https:; font-src <%= cspSource %>; script-src 'nonce-<%= nonce %>';">

    </head>
    <body id="welcome-body">
        <div id="welcome-container">
            <a class="welcome-header" href = "https://odoo.com">
                <img src="https://odoocdn.com/openerp_website/static/src/img/assets/png/odoo_logo.png" id="welcome-logo" />
            </a>
            <h1 class="welcome-header">Welcome to Odoo</h1>
            <div class="welcome-header" id="welcome-title">
                Odoo Language Server will help you to write Odoo modules by providing you with autocompletion, hover, goto definition, code analysis and more.
            </div>
            <%- alertHTML %>
            <div class="display-welcome-checkbox welcome-header">
                <vscode-checkbox id="displayOdooWelcomeOnStart" <%= displayOnStartupCheckbox %>>Show Odoo welcome page on startup</vscode-checkbox>
            </div>
            <h2>How to install ?</h2>
            <section>
                If you see this message, it means that your extension is already installed. But to make it shine, it is better to ensure that no other language server is actually running concurrently with this extension.
                <br/>
                The extension is made to work alone or with the Python Extension of VsCode (ms-python.python). If you have another Python language server however, you should probably deactivate it
                to avoid double autocompletion and to remove wrong error diagnotics. To do that, you can go in the "Extensions" tab, search for your language server and click on "Disable" or "Disable (workspace)".
                <br/>
                On start-up the extension will prompt you to disable the Language Server from the Python extension, that behavior can be altered in the settings.
            </section>
            <h2> How to use the extension ? </h2>
            <section>
                <p>
                    The extension works by setting up a configuration, then analyzing your code with the loaded configuration.</br>
                    You first have to create the configurations you'll use later.
                </p>
                <p>
                    Your available configurations are displayed here:<br/>
                    <img class="img-margins" src="<%= image_1 %>" /><br/>
                    Click on it to select it, or the eye icon at the edge to see that specific configuration<br/>
                    You could also just See all the configurations by clicking on the "See all configurations" button.<br/>:
                    <img class="img-margins" src="<%= image_2 %>" /><br/>
                </p>
            </section>
            <h2> Configuration </h2>
            <section>
                <p>
                    <ul>
                        <li>
                            The configuration is a set of parameters that will be used to analyze your code. It contains the path to your Odoo source code, the addons you want to use, the Python interpreter to use, and more.
                        </li>
                        <li>
                            You can create a new configuration by creating one or more <code>odools.toml</code> files.
                        </li>
                        <li>
                            Structure of the <code>odools.toml</code> file:
                            <ul>
                                <li>
                                    There is always one <b>"root"</b> configuration profile, which is the default configuration. It is generated for you by default even if you do not provide any configuration file.<br/>
                                    It will use defaults and also infer odoo path and addons paths from your workspace folders.
                                </li>
                                <li>
                                    You can create multiple profiles, each with its own set of parameters. Each profile is a section in the <code>odools.toml</code> file, and you can switch between them.
                                </li>
                                <li>
                                    Each profile can have its own set of parameters, such as the path to the Odoo source code, the addons to use, the Python interpreter to use, and more.
                                </li>
                                <li>
                                    Profiles can extend each other, so you can have a base profile with common parameters and then extend it with specific parameters for each profile.
                                </li>
                                <li>
                                    Profile extension works only on the same files, so that it does not affect the merging of <code>odools.toml</code> files in child directories.
                                </li>
                                <li>
                                    <code>odools.toml</code> files are searched for from each workspace folder and up through its parent directories until the root, while merging them together.<br/>
                                    Priorities are given to the most specific file, so if you have a file in your workspace folder, it will override the one in the parent directory.<br/>
                                    This allows you to have a global configuration in your home directory, and then override it with a specific configuration in your workspace folder.<br/>
                                    Also, you have the freedom to have multiple <code>odools.toml</code> files in different directories, and compose them with profiles and extensions for your use case.<br/>
                                </li>
                                <li>
                                    However, there can be no conflicts between profiles between workspace folders.
                                    <ul>
                                        <li>
                                            If we have two workspace folders, each with its own <code>odools.toml</code> file, the profiles in those files should not conflict with each other otherwise they won't start.
                                        </li>
                                        <li>
                                            It is the responsibility of the user to ensure that the profiles in the <code>odools.toml</code> files in different workspace folders do not conflict with each other.
                                        </li>
                                        <li>
                                            Using the profiles features and extensions, you can always create non-conflicting profiles that work without disrupting other profiles.
                                        </li>
                                        <li>
                                            Conflicts can happen even if you do not specifically create them, for example if you open a workspace with two folders that are valid odoo paths, in that case it is ambiguous which one to use.
                                        </li>
                                        <li>
                                            Addons folders are merged together by default between workspace folders.
                                        </li>
                                        <li>
                                            <b>Important:</b> <br/>
                                            <ul>
                                                <li>
                                                    <b>Set semantics:</b> <code>addons_paths</code> and <code>additional_stubs</code> are merged as <b>sets</b> (unique, unordered). Duplicates are removed and order is not preserved.
                                                </li>
                                                <li>
                                                    <b>Conflicts:</b> If two workspace folders define the same profile with different values for a field (e.g., <code>file_cache</code>), the extension will refuse to start and show an error.
                                                </li>
                                                <li>
                                                    <b>Profile extension errors:</b> If a profile extends a non-existent profile, or if there is a cycle in profile extensions, the extension will show an error and not start.
                                                </li>
                                                <li>
                                                    <b>Path normalization:</b> All paths are normalized (case, slashes, trailing slashes) and deduplicated.
                                                </li>
                                                <li>
                                                    <b>Restart required:</b> Some configuration changes (such as <code>odoo_path</code>, <code>addons_paths</code>, <code>python_path</code>, <code>additional_stubs</code>) require a restart of the language server to take effect.
                                                </li>
                                                <li>
                                                    <b>Automatic reload:</b> <code>odools.toml</code> files located directly under workspace folders are watched for changes and will automatically update the configuration when modified. However, configuration files located elsewhere (such as in parent directories or outside the workspace) are not watched, and changes to those files will not be picked up automatically, regardless of which configuration fields are changed.
                                                </li>
                                            </ul>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    When seeing the configuration, you conveniently have the source of that configuration value, which could be a default value (<code>$default</code>), a value from the <code>odools.toml</code> file, or an inferred value from the workspace folders (<code>$workspaceFolder:FOLDERNAME</code>).<br/>
                                    You can click on the links to open the file; you might be prompted to trust the link.
                                </li>
                                <li>
                                    For now all the paths are relative to the current path of the <code>odools.toml</code> file.<br/>
                                </li>
                                <li>
                                    Some variables are allowed in odoo_paths, addons_paths and python_path: ${userHome}, ${workspaceFolder:FOLDERNAME}, and ${workspaceFolder}.<br/>
                                    Setting the <code>odoo_path</code> to ${workspaceFolder} will use the current workspace folder as the Odoo source code path.<br/>
                                </li>
                                <li>
                                    Extends with profiles that do not exist will be ignored, and cyclic dependencies will result in undefined behavior for now.
                                </li>
                            </ul>
                        </li>
                    </ul>
                </p>
                <p>
                    Configuration Structure parameters:
                </p>
                <ul>
                    <li><b>name</b> (string): Name of the configuration profile (default: "root")</li>
                    <li><b>extends</b> (string, optional): Name of another profile in the same file to extend from</li>
                    <li><b>odoo_path</b> (string, optional): Path to the Odoo source code</li>
                    <li><b>addons_paths</b> (array of string): List of addon directories to include</li>
                    <li><b>addons_merge</b> ("merge" | "override", default: "merge"): How to combine addons_paths with parent profile ("merge" to combine, "override" to replace)</li>
                    <li><b>python_path</b> (string, optional): Path to the Python interpreter</li>
                    <li><b>additional_stubs</b> (array of string): Additional stub directories</li>
                    <li><b>additional_stubs_merge</b> ("merge" | "override", default: "merge"): How to combine additional_stubs with parent profile</li>
                    <li><b>refresh_mode</b> ("onSave" | "adaptive" | "off", default: "adaptive"): When to refresh the server data</li>
                    <li><b>file_cache</b> (bool, default: true): Enable file caching for workspace files</li>
                    <li><b>diag_missing_imports</b> ("all" | "only_odoo" | "none", default: "all"): Diagnostics for missing imports</li>
                    <li><b>ac_filter_model_names</b> (bool, default: true): Only show model names from module dependencies in autocompletion</li>
                    <li><b>auto_save_delay</b> (integer, default: 1000): Delay in ms before refreshing after an update <b>(minimum 1000, maximum 15000; values outside this range will be clamped)</b></li>
                    <li><b>add_workspace_addon_path</b> (bool, default: false): Add the workspace folder as an addon path if it looks like an addon if you specified other addons paths</li>
                </ul>
                <p>
                    <b>Examples:</b>
                </p>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 1: Multiple workspace folders, no config files</b><br/>
                    <span style="color:#888">// Folders:</span><br/>
                    <span>workspace/</span><br/>
                    <span>&nbsp;&nbsp;odoo/</span><br/>
                    <span>&nbsp;&nbsp;enterprise/</span><br/>
                    <span>&nbsp;&nbsp;extra-addons/</span><br/>
                    <span style="color:#888">// Open VSCode with all three as workspace folders</span><br/>
                    <span>Result:</span><br/>
                    <ul>
                        <li><b>odoo_path</b>: set to the folder containing <code>odoo/odoo/release.py</code> (if found)</li>
                        <li><b>addons_paths</b>: all folders that look like Odoo addons (e.g., <code>enterprise</code>, <code>extra-addons</code>)</li>
                        <li>All other fields use defaults</li>
                    </ul>
                    <img class="img-margins" src="<%= image_3 %>" /><br/>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 2: Two workspace folders, each with its own odools.toml</b><br/>
                    <span style="color:#888">// Folder structure:</span><br/>
                    <span>ws1/odools.toml</span><br/>
                    <span>ws2/odools.toml</span><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "root"
file_cache = false
addons_paths = ["${workspaceFolder}"]
</pre>
                    <span style="color:#888">// ws2/odools.toml:</span><br/>
<pre>
[[config]]
name = "root"
file_cache = false
addons_paths = ["${workspaceFolder}"]
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>file_cache</b>: <code>false</code> (no conflict, both agree)</li>
                        <li><b>addons_paths</b>: both workspace folders are included (set semantics, order not guaranteed)</li>
                        <li>All other fields use defaults</li>
                    </ul>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 3: Two workspace folders, conflicting config</b><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "root"
file_cache = true
</pre>
                    <span style="color:#888">// ws2/odools.toml:</span><br/>
<pre>
[[config]]
name = "root"
file_cache = false
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>Error:</b> Conflict detected for <code>file_cache</code> in profile <code>root</code>. The extension will not start.</li>
                    </ul>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 4: Profile extension and shadowing</b><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "base"
file_cache = false
auto_save_delay = 2000

[[config]]
name = "root"
extends = "base"
auto_save_delay = 5000
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>file_cache</b>: <code>false</code> (inherited from <code>base</code>)</li>
                        <li><b>auto_save_delay</b>: <code>5000</code> (overrides <code>base</code>)</li>
                    </ul>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 5: Profile extension cycle (error)</b><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "a"
extends = "b"
file_cache = true

[[config]]
name = "b"
extends = "a"
file_cache = false
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>Error:</b> Circular dependency detected in profile extensions! The extension will not start.</li>
                    </ul>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 6: Profile extends non-existent profile (error)</b><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "root"
extends = "doesnotexist"
file_cache = true
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>Error:</b> Profile 'root' extends non-existing profile 'doesnotexist'. The extension will not start.</li>
                    </ul>
                </div>
                <div style="font-family:monospace; font-size:1em; margin-bottom:1em;">
                    <b>Example 7: Advanced configuration with multiple profiles</b><br/>
                    <span style="color:#888">// ws1/odools.toml:</span><br/>
<pre>
[[config]]
name = "base"
odoo_path = "/path/to/odoo"
addons_paths = ["/path/to/addons"]
python_path = "/path/to/python"

[[config]]
name = "dev"
extends = "base"
file_cache = false
auto_save_delay = 3000

[[config]]
name = "prod"
extends = "base"
file_cache = true
auto_save_delay = 1000
</pre>
                    <span>Result:</span>
                    <ul>
                        <li><b>base profile:</b> Sets up the basic environment with odoo_path, addons_paths, and python_path</li>
                        <li><b>dev profile:</b> Extends base, disables file cache, and sets a longer auto save delay</li>
                        <li><b>prod profile:</b> Extends base, enables file cache, and sets a shorter auto save delay</li>
                    </ul>
                </div>
                <p>
                    When your configuration is ready, restart the language server to reload the configs, select it from the panel. This selection will run for the current workspace.<br/>
                    While the wheel next to the Odoo button is spinning, the extension is loading the configuration. When it's done, the wheel will stop spinning and the extension will start to help you in your work.<br/>
                    You can use your vscode while the extension is loading, but not all features will be available until the configuration is ready.
                </p>
            </section>
        </div>
    </body>
</html>